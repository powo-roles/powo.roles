---
doc:
  help: "install you computer and code!"
args:
  user:
    is_var: true
    required: false
    default: null
  password:
    is_var: true
    required: false
    default: null
  passphrase:
    required: false
    default: null
    is_var: true
  uid:
    required: false
    is_var: true
    default: null
  fullname:
    required: false
    is_var: true
    default: null
tasks:
  - powo.utils
  - powo.checks
  - powo.filesystem
  - powo.user:
      pu_create: "{{ is_user_supplied }}"
      pu_user: "{{ play_user }}"
      pu_uid: "{{ play_uid }}"
      pu_password: "{{ play_password }}"
      pu_passphrase: "{{ play_passphrase }}"
      pu_fullname: "{{ play_fullname }}"
      pu_sudo: true
      pu_profiles:
        - filename: 50-java.conf
          template: "{{ bash_java_template }}"
        - filename: 50-maven.conf
          template: "{{ bash_maven_template }}"
  - powo.ubuntu-backports
  - powo.apache
  - powo.php
  - postgresql:
      postgresql_versions:
        - "9.6"
        - "10"
  - powo.postgresql-stop
  - postgresql-cluster:
      postgresql_cluster_clusters:
        - name: default
          path: /data/services/postgresql/9.6-default/
          postgresql_version: "9.6"
          port: 5432
          pg_hba: pg_hba_local.conf
        - name: default
          path: /data/services/postgresql/10-default/
          postgresql_version: "10"
          port: 5433
          pg_hba: pg_hba_local.conf
  - powo.vagrant:
      pva_dest_folder: "{{ tools_folder }}/vagrant"
  - powo.gnome-shell
  - powo.chrome
  - powo.misc
  - powo.eclipse:
      pec_install_base_folder: "{{ apps_folder }}"
      pec_download_folder: "{{ tools_folder }}/eclipse"
      pec_bundles:
        - "{{ bundle_eclipse_java_471 }}"
        - "{{ bundle_eclipse_java_472 }}"
  - powo.java:
      pja_install_base_folder: "{{ apps_folder }}"
      pja_download_folder: "{{ tools_folder }}/java"
      pja_bundles:
        - "{{ bundle_jdk1001 }}"
        - "{{ bundle_jdk18u172 }}"
  - powo.maven:
      pma_install_base_folder: "{{ apps_folder }}"
      pma_download_folder: "{{ tools_folder }}/maven"
      pma_bundles:
        - "{{ bundle_maven_3_3_9 }}"
        - "{{ bundle_maven_3_5_3 }}"
  - powo.tomcat:
      pto_install_base_folder: "{{ apps_folder }}"
      pto_download_folder: "{{ tools_folder }}/tomcat"
      pto_bundles:
        - "{{ bundle_tomcat_7_0_88 }}"
        - "{{ bundle_tomcat_8_0_52 }}"
        - "{{ bundle_tomcat_8_5_31 }}"
        - "{{ bundle_tomcat_9_0_8 }}"
  - powo.virtualbox
  - powo.symlinks:
      psy_directories:
        - ~/.bin
      psy_symlinks:
        - path: ~/.bin/java
          src: "{{ bin_java }}"
        - path: ~/.bin/eclipse
          src: "{{ bin_eclipse }}"
        - path: ~/.bin/mvn
          src: "{{ bin_maven }}"
meta:
  use_become: true
vars:
  become: true
  become_user: "{{ play_user }}"
  apps_folder: "{{ play_home }}/Documents/apps"
  tools_folder: "{{ play_home }}/Documents/tools"
  is_user_supplied: "{{ user is not none }}"
  play_user: "{{ user if user is not none else lookup('pipe', 'whoami') }}"
  play_uid: "{{ uid if uid is not none else lookup('pipe', 'id -u') }}"
  play_password: "{{ password | password_hash('sha512') if password else none }}"
  play_fullname: "{{ fullname }}"
  play_home: "{{ lookup('pipe', 'getent passwd ' + play_user).split(':')[5] }}"
  play_passphrase: "{{ passphrase }}"
  bundle_jdk18u172:
    url: http://download.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.tar.gz
    checksum: sha256:28a00b9400b6913563553e09e8024c286b506d8523334c93ddec6c9ec7e9d346
    desktop_name: Java 1.8u162
  bundle_jdk1001:
    url: http://download.oracle.com/otn-pub/java/jdk/10.0.1+10/fb4372174a714e6b8c52526dc134031e/jdk-10.0.1_linux-x64_bin.tar.gz
    checksum: sha256:ae8ed645e6af38432a56a847597ac61d4283b7536688dbab44ab536199d1e5a4
    desktop_name: Java 10.0.1
    basename: jdk-10.0.1_linux-x64
  bundle_tomcat_7_0_88:
    url: https://archive.apache.org/dist/tomcat/tomcat-7/v7.0.88/bin/apache-tomcat-7.0.88.tar.gz
    checksum: sha512:5adb54155f2da0d59c86af9b6df5cce110e608b7f894cd0398821797cf87502bd2938bc8494e021daf1990b337267c391e90e129c907e9a548d23cb52b2a8451
  bundle_tomcat_8_0_52:
    url: https://archive.apache.org/dist/tomcat/tomcat-8/v8.0.52/bin/apache-tomcat-8.0.52.tar.gz
    checksum: sha512:23ba3c005d2e1bff30360a7aca5882ba7acaef0001395b1f77eb182c1f9c6a48db7f39b9f71ebdfb20668eca32c5f03bf00364f77d47e368850a794f6d65ea56
  bundle_tomcat_8_5_31:
    url: https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.31/bin/apache-tomcat-8.5.31.tar.gz
    checksum: sha512:a961eedc4b0c0729f1fb96dafb75eb48e000502233b849f47c84a6355873bc96d131b112400587e96391262e0659df9b991b4e66a78fda74168f939c4ab5af88
  bundle_tomcat_9_0_8:
    url: https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.8/bin/apache-tomcat-9.0.8.tar.gz
    checksum: sha512:51af864fc3815bf40a200b8250f6e6aad66378f5b725199a308c0296957c58584a6358fb7df861694acea764b69ba4ce7dba0aa77792bd33ed38b66c24ff5b55
  bundle_maven_3_5_3:
    url: http://mirrors.ircam.fr/pub/apache/maven/maven-3/3.5.3/binaries/apache-maven-3.5.3-bin.tar.gz
    checksum: md5:51025855d5a7456fc1a67666fbef29de
    basename: maven-3.5.3.tar.gz
  bundle_maven_3_3_9:
    url: http://mirrors.ircam.fr/pub/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz
    checksum: md5:516923b3955b6035ba6b0a5b031fbd8b
    basename: maven-3.3.9.tar.gz
  bundle_eclipse_java_471:
    url: http://dl.likide.org/eclipse/releases/eclipse-java-extra-oxygen-1-linux-gtk-x86_64.tar.gz
    checksum: sha256:7d0e7bca124474cd173e199c47103dab98fd4463bd097d03dd24abc17ee7a337
    desktop_name: Eclipse 4.7.1 (extra)
    vm: "{{ bin_java }}"
  bundle_eclipse_java_472:
    url: http://dl.likide.org/eclipse/releases/eclipse-java-extra-oxygen-2-linux-gtk-x86_64.tar.gz
    checksum: sha256:e538d55ab065535651115f961aa9345650e7516d735e99cced79cd15c37adbd4
    desktop_name: Eclipse 4.7.2 (extra)
    vm: "{{ bin_java }}"
  bin_java: "{{ apps_folder }}/{{ bundle_jdk18u172.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/bin/java"
  bin_eclipse: "{{ apps_folder }}/{{ bundle_eclipse_java_472.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/eclipse"
  bin_maven: "{{ apps_folder }}/{{ bundle_maven_3_5_3.basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/bin/mvn"
  bash_maven_template: |
    export MAVEN_OPTS="-Xmx1024m"
  bash_java_template: |
    export JAVA_HOME={{ bin_java | dirname | dirname | expanduser | quote }}
