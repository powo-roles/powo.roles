---
doc:
  help: "install you computer and code!"
args:
  user:
    is_var: true
    required: false
    default: null
  password:
    is_var: true
    required: false
    default: null
  passphrase:
    required: false
    default: null
    is_var: true
  uid:
    required: false
    is_var: true
    default: null
  fullname:
    required: false
    is_var: true
    default: null
tasks:
  - powo.utils
  - powo.checks
  - powo.filesystem
  - powo.user:
      pu_create: "{{ is_user_supplied }}"
      pu_user: "{{ play_user }}"
      pu_uid: "{{ play_uid }}"
      pu_password: "{{ play_password }}"
      pu_passphrase: "{{ play_passphrase }}"
      pu_fullname: "{{ play_fullname }}"
      pu_sudo: true
      pu_profiles:
        - filename: 50-java.conf
          template: "{{ bash_java_template }}"
        - filename: 50-maven.conf
          template: "{{ bash_maven_template }}"
  - powo.ubuntu-backports
  - powo.apache
  - powo.php
  - postgresql:
      postgresql_versions:
        - "9.6"
        - "10"
  - powo.postgresql-stop
  - postgresql-cluster:
      postgresql_cluster_clusters:
        - name: default
          path: /data/services/postgresql/9.6-default/
          postgresql_version: "9.6"
          port: 5432
          pg_hba: pg_hba_local.conf
        - name: default
          path: /data/services/postgresql/10-default/
          postgresql_version: "10"
          port: 5433
          pg_hba: pg_hba_local.conf
  - powo.vagrant:
      pva_dest_folder: "{{ tools_folder }}/vagrant"
  - powo.gnome-shell
  - powo.chrome
  - powo.misc
  - powo.eclipse:
      pec_install_base_folder: "{{ apps_folder }}"
      pec_download_folder: "{{ tools_folder }}/eclipse"
      pec_bundles:
        - "{{ bundle_eclipse_java_473 }}"
        - "{{ bundle_eclipse_java_48 }}"
  - powo.java:
      pja_install_base_folder: "{{ apps_folder }}"
      pja_download_folder: "{{ tools_folder }}/java"
      pja_bundles:
        - "{{ bundle_jdk1002 }}"
        - "{{ bundle_jdk8u181 }}"
  - powo.maven:
      pma_install_base_folder: "{{ apps_folder }}"
      pma_download_folder: "{{ tools_folder }}/maven"
      pma_bundles:
        - "{{ bundle_maven_3_3_9 }}"
        - "{{ bundle_maven_3_5_4 }}"
  - powo.tomcat:
      pto_install_base_folder: "{{ apps_folder }}"
      pto_download_folder: "{{ tools_folder }}/tomcat"
      pto_bundles:
        - "{{ bundle_tomcat_7_0_90 }}"
        - "{{ bundle_tomcat_8_0_53 }}"
        - "{{ bundle_tomcat_8_5_32 }}"
        - "{{ bundle_tomcat_9_0_10 }}"
  - powo.virtualbox
  - powo.symlinks:
      psy_directories:
        - ~/.bin
      psy_symlinks:
        - path: ~/.bin/java
          src: "{{ bin_java }}"
        - path: ~/.bin/eclipse
          src: "{{ bin_eclipse }}"
        - path: ~/.bin/mvn
          src: "{{ bin_maven }}"
        - path: "{{ apps_folder }}/apache-tomcat-7"
          src: "{{ dir_tomcat_7 }}"
        - path: "{{ apps_folder }}/apache-tomcat-8"
          src: "{{ dir_tomcat_8 }}"
        - path: "{{ apps_folder }}/apache-tomcat-85"
          src: "{{ dir_tomcat_85 }}"
        - path: "{{ apps_folder }}/apache-tomcat-9"
          src: "{{ dir_tomcat_9 }}"
        - path: "{{ apps_folder }}/jdk-8"
          src: "{{ dir_jdk_8 }}"
        - path: "{{ apps_folder }}/jdk-10"
          src: "{{ dir_jdk_10 }}"
        - path: "{{ apps_folder }}/eclipse-oxygen"
          src: "{{ dir_eclipse_47 }}"
        - path: "{{ apps_folder }}/eclipse-photon"
          src: "{{ dir_eclipse_48 }}"
meta:
  use_become: true
vars:
  become: true
  become_user: "{{ play_user }}"
  apps_folder: "{{ play_home }}/Documents/apps"
  tools_folder: "{{ play_home }}/Documents/tools"
  is_user_supplied: "{{ user is not none }}"
  play_user: "{{ user if user is not none else lookup('pipe', 'whoami') }}"
  play_uid: "{{ uid if uid is not none else lookup('pipe', 'id -u') }}"
  play_password: "{{ password | password_hash('sha512') if password else none }}"
  play_fullname: "{{ fullname }}"
  play_home: "{{ lookup('pipe', 'getent passwd ' + play_user).split(':')[5] }}"
  play_passphrase: "{{ passphrase }}"
  bundle_jdk8u181:
    url: http://download.oracle.com/otn-pub/java/jdk/8u181-b13/96a7b8442fe848ef90c96a2fad6ed6d1/jdk-8u181-linux-x64.tar.gz
    checksum: sha256:1845567095bfbfebd42ed0d09397939796d05456290fb20a83c476ba09f991d3
    desktop_name: Java 1.8u181
  bundle_jdk1002:
    url: http://download.oracle.com/otn-pub/java/jdk/10.0.2+13/19aef61b38124481863b1413dce1855f/jdk-10.0.2_linux-x64_bin.tar.gz
    checksum: sha256:6633c20d53c50c20835364d0f3e172e0cbbce78fff81867488f22a6298fa372b
    desktop_name: Java 10.0.2
    basename: jdk-10.0.2_linux-x64
  bundle_tomcat_7_0_90:
    url: https://archive.apache.org/dist/tomcat/tomcat-7/v7.0.90/bin/apache-tomcat-7.0.90.tar.gz
    checksum: sha512:c7a47135b99684425260cd906cf5c9a5226837d3681d84ae4e3bb199068e97f0e63d07393d91ca0436204a1dc92bf9bd9a4a1c4c893187703e023503bbd81901
  bundle_tomcat_8_0_53:
    url: https://archive.apache.org/dist/tomcat/tomcat-8/v8.0.53/bin/apache-tomcat-8.0.53.tar.gz
    checksum: sha512:cd8a4e48a629a2f2bb4ce6b101ebcce41da52b506064396ec1b2915c0b0d8d82123091242f2929a649bcd8b65ecf6cd1ab9c7d90ac0e261821097ab6fbe22df9
  bundle_tomcat_8_5_32:
    url: https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.32/bin/apache-tomcat-8.5.32.tar.gz
    checksum: sha512:fc010f4643cb9996cad3812594190564d0a30be717f659110211414faf8063c61fad1f18134154084ad3ddfbbbdb352fa6686a28fbb6402d3207d4e0a88fa9ce
  bundle_tomcat_9_0_10:
    url: https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.10/bin/apache-tomcat-9.0.10.tar.gz
    checksum: sha512:ecdee920fcb75bf30cd87c350e0732e8fa566911cd16cf2759689edd324ebac911c0d154e79ffc67e948b29eacc49c88dadc5954383d3c4af2fdb952f3d1c371
  bundle_maven_3_5_4:
    url: http://mirror.ibcp.fr/pub/apache/maven/maven-3/3.5.4/binaries/apache-maven-3.5.4-bin.tar.gz
    basename: maven-3.5.4.tar.gz
    checksum: sha256:ce50b1c91364cb77efe3776f756a6d92b76d9038b0a0782f7d53acf1e997a14d
  bundle_maven_3_3_9:
    url: http://mirrors.ircam.fr/pub/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz
    checksum: md5:516923b3955b6035ba6b0a5b031fbd8b
    basename: maven-3.3.9.tar.gz
  bundle_eclipse_java_473:
    url: https://nexus.tools.kobalt-si.fr/repository/eclipse/oxygen/eclipse-java-extra-oxygen-3-linux-gtk-x86_64.tar.gz
    checksum: sha256:a9f0a7a9e5ed4bba9a25b18335719758316c2c6e16c7fe33c10025069abdec0f
    desktop_name: Eclipse 4.7.3 (extra)
    vm: "{{ bin_java }}"
  bundle_eclipse_java_48:
    url: https://nexus.tools.kobalt-si.fr/repository/eclipse/photon/eclipse-java-extra-photon-linux-gtk-x86_64.tar.gz
    checksum: sha256:7820930641f22a9b70011fcbd3a8c67796f67998a5831dfc4a7b4a8d680eb905
    desktop_name: Eclipse 4.8 (extra)
    vm: "{{ bin_java }}"
  bin_java: "{{ apps_folder }}/{{ bundle_jdk8u181.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/bin/java"
  bin_java_10: "{{ apps_folder }}/{{ bundle_jdk1002.basename }}/bin/java"
  bin_eclipse: "{{ apps_folder }}/{{ bundle_eclipse_java_48.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/eclipse"
  bin_maven: "{{ apps_folder }}/{{ bundle_maven_3_5_4.basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/bin/mvn"
  dir_jdk_8: "{{ apps_folder }}/{{ bundle_jdk8u181.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/"
  dir_jdk_10: "{{ apps_folder }}/{{ bundle_jdk1002.basename }}/"
  dir_eclipse_47: "{{ apps_folder }}/{{ bundle_eclipse_java_473.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/"
  dir_eclipse_48: "{{ apps_folder }}/{{ bundle_eclipse_java_48.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/"
  dir_tomcat_7: "{{ apps_folder }}/{{ bundle_tomcat_7_0_90.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}"
  dir_tomcat_8: "{{ apps_folder }}/{{ bundle_tomcat_8_0_53.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}"
  dir_tomcat_85: "{{ apps_folder }}/{{ bundle_tomcat_8_5_32.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}"
  dir_tomcat_9: "{{ apps_folder }}/{{ bundle_tomcat_9_0_10.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}"
  bash_maven_template: |
    export MAVEN_OPTS="-Xmx1024m"
  bash_java_template: |
    export JAVA_HOME={{ bin_java | dirname | dirname | expanduser | quote }}
