---
doc:
  help: "install you computer and code!"
args:
  user:
    is_var: true
    required: false
    default: null
  password:
    is_var: true
    required: false
    default: null
  passphrase:
    required: false
    default: null
    is_var: true
  uid:
    required: false
    is_var: true
    default: null
  fullname:
    required: false
    is_var: true
    default: null
tasks:
  - powo.utils
  - powo.checks
  - powo.filesystem
  - powo.user:
      pu_create: "{{ is_user_supplied }}"
      pu_user: "{{ play_user }}"
      pu_uid: "{{ play_uid }}"
      pu_password: "{{ play_password }}"
      pu_passphrase: "{{ play_passphrase }}"
      pu_fullname: "{{ play_fullname }}"
      pu_sudo: true
      pu_profiles:
        - filename: 50-java.conf
          template: "{{ bash_java_template }}"
        - filename: 50-maven.conf
          template: "{{ bash_maven_template }}"
  - powo.ubuntu-backports
  - powo.apache
  - powo.php
  - postgresql:
      postgresql_versions:
        - "9.6"
        - "10"
  - powo.postgresql-stop
  - postgresql-cluster:
      postgresql_cluster_clusters:
        - name: default
          path: /data/services/postgresql/9.6-default/
          postgresql_version: "9.6"
          port: 5432
          pg_hba: pg_hba_local.conf
        - name: default
          path: /data/services/postgresql/10-default/
          postgresql_version: "10"
          port: 5433
          pg_hba: pg_hba_local.conf
  - powo.vagrant:
      pva_dest_folder: "{{ tools_folder }}/vagrant"
  - powo.gnome-shell
  - powo.chrome
  - powo.misc
  - powo.eclipse:
      pec_install_base_folder: "{{ apps_folder }}"
      pec_download_folder: "{{ tools_folder }}/eclipse"
      pec_bundles:
        - "{{ bundle_eclipse_java_473 }}"
        - "{{ bundle_eclipse_java_48 }}"
  - powo.java:
      pja_install_base_folder: "{{ apps_folder }}"
      pja_download_folder: "{{ tools_folder }}/java"
      pja_bundles:
        - "{{ bundle_jdk1002 }}"
        - "{{ bundle_jdk18u181 }}"
  - powo.maven:
      pma_install_base_folder: "{{ apps_folder }}"
      pma_download_folder: "{{ tools_folder }}/maven"
      pma_bundles:
        - "{{ bundle_maven_3_3_9 }}"
        - "{{ bundle_maven_3_5_3 }}"
  - powo.tomcat:
      pto_install_base_folder: "{{ apps_folder }}"
      pto_download_folder: "{{ tools_folder }}/tomcat"
      pto_bundles:
        - "{{ bundle_tomcat_7_0_88 }}"
        - "{{ bundle_tomcat_8_0_52 }}"
        - "{{ bundle_tomcat_8_5_31 }}"
        - "{{ bundle_tomcat_9_0_8 }}"
  - powo.virtualbox
  - powo.symlinks:
      psy_directories:
        - ~/.bin
      psy_symlinks:
        - path: ~/.bin/java
          src: "{{ bin_java }}"
        - path: ~/.bin/eclipse
          src: "{{ bin_eclipse }}"
        - path: ~/.bin/mvn
          src: "{{ bin_maven }}"
meta:
  use_become: true
vars:
  become: true
  become_user: "{{ play_user }}"
  apps_folder: "{{ play_home }}/Documents/apps"
  tools_folder: "{{ play_home }}/Documents/tools"
  is_user_supplied: "{{ user is not none }}"
  play_user: "{{ user if user is not none else lookup('pipe', 'whoami') }}"
  play_uid: "{{ uid if uid is not none else lookup('pipe', 'id -u') }}"
  play_password: "{{ password | password_hash('sha512') if password else none }}"
  play_fullname: "{{ fullname }}"
  play_home: "{{ lookup('pipe', 'getent passwd ' + play_user).split(':')[5] }}"
  play_passphrase: "{{ passphrase }}"
  bundle_jdk18u181:
    url: http://download.oracle.com/otn-pub/java/jdk/8u181-b13/96a7b8442fe848ef90c96a2fad6ed6d1/jdk-8u181-linux-x64.tar.gz
    checksum: sha256:1845567095bfbfebd42ed0d09397939796d05456290fb20a83c476ba09f991d3
    desktop_name: Java 1.8u181
  bundle_jdk1002:
    url: http://download.oracle.com/otn-pub/java/jdk/10.0.2+13/19aef61b38124481863b1413dce1855f/jdk-10.0.2_linux-x64_bin.tar.gz
    checksum: sha256:6633c20d53c50c20835364d0f3e172e0cbbce78fff81867488f22a6298fa372b
    desktop_name: Java 10.0.2
    basename: jdk-10.0.2_linux-x64
  bundle_tomcat_7_0_88:
    url: https://archive.apache.org/dist/tomcat/tomcat-7/v7.0.88/bin/apache-tomcat-7.0.88.tar.gz
    checksum: sha512:5adb54155f2da0d59c86af9b6df5cce110e608b7f894cd0398821797cf87502bd2938bc8494e021daf1990b337267c391e90e129c907e9a548d23cb52b2a8451
  bundle_tomcat_8_0_52:
    url: https://archive.apache.org/dist/tomcat/tomcat-8/v8.0.52/bin/apache-tomcat-8.0.52.tar.gz
    checksum: sha512:23ba3c005d2e1bff30360a7aca5882ba7acaef0001395b1f77eb182c1f9c6a48db7f39b9f71ebdfb20668eca32c5f03bf00364f77d47e368850a794f6d65ea56
  bundle_tomcat_8_5_31:
    url: https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.31/bin/apache-tomcat-8.5.31.tar.gz
    checksum: sha512:a961eedc4b0c0729f1fb96dafb75eb48e000502233b849f47c84a6355873bc96d131b112400587e96391262e0659df9b991b4e66a78fda74168f939c4ab5af88
  bundle_tomcat_9_0_8:
    url: https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.8/bin/apache-tomcat-9.0.8.tar.gz
    checksum: sha512:51af864fc3815bf40a200b8250f6e6aad66378f5b725199a308c0296957c58584a6358fb7df861694acea764b69ba4ce7dba0aa77792bd33ed38b66c24ff5b55
  bundle_maven_3_5_3:
    url: http://mirrors.ircam.fr/pub/apache/maven/maven-3/3.5.3/binaries/apache-maven-3.5.3-bin.tar.gz
    checksum: md5:51025855d5a7456fc1a67666fbef29de
    basename: maven-3.5.3.tar.gz
    checksum: sha256:218b3b340c3f6d05d940b817d0270dfe0cfd657a636bad074dcabe0c111961bf
  bundle_maven_3_3_9:
    url: http://mirrors.ircam.fr/pub/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz
    checksum: md5:516923b3955b6035ba6b0a5b031fbd8b
    basename: maven-3.3.9.tar.gz
  bundle_eclipse_java_473:
    url: https://nexus.tools.kobalt-si.fr/repository/eclipse/oxygen/eclipse-java-extra-oxygen-3-linux-gtk-x86_64.tar.gz
    checksum: sha256:a9f0a7a9e5ed4bba9a25b18335719758316c2c6e16c7fe33c10025069abdec0f
    desktop_name: Eclipse 4.7.3 (extra)
    vm: "{{ bin_java }}"
  bundle_eclipse_java_48:
    url: https://nexus.tools.kobalt-si.fr/repository/eclipse/photon/eclipse-java-extra-photon-linux-gtk-x86_64.tar.gz
    checksum: sha256:7820930641f22a9b70011fcbd3a8c67796f67998a5831dfc4a7b4a8d680eb905
    desktop_name: Eclipse 4.8 (extra)
    vm: "{{ bin_java }}"
  bin_java: "{{ apps_folder }}/{{ bundle_jdk18u181.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/bin/java"
  bin_java_10: "{{ apps_folder }}/{{ bundle_jdk1002.basename }}/bin/java"
  bin_eclipse: "{{ apps_folder }}/{{ bundle_eclipse_java_473.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/eclipse"
  bin_maven: "{{ apps_folder }}/{{ bundle_maven_3_5_3.basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/bin/mvn"
  bash_maven_template: |
    export MAVEN_OPTS="-Xmx1024m"
  bash_java_template: |
    export JAVA_HOME={{ bin_java | dirname | dirname | expanduser | quote }}
