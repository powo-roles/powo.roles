---
doc:
  help: "install you computer and code!"
args:
  user:
    is_var: true
    required: false
    default: null
  password:
    is_var: true
    required: false
    default: null
  passphrase:
    required: false
    default: null
    is_var: true
  uid:
    required: false
    is_var: true
    default: null
  fullname:
    required: false
    is_var: true
    default: null
tasks:
  - powo.utils
  - powo.checks
  - powo.filesystem
  - powo.user:
      pu_create: "{{ is_user_supplied }}"
      pu_user: "{{ play_user }}"
      pu_uid: "{{ play_uid }}"
      pu_password: "{{ play_password }}"
      pu_passphrase: "{{ play_passphrase }}"
      pu_fullname: "{{ play_fullname }}"
      pu_sudo: true
      pu_profiles:
        - filename: 50-java.conf
          template: "{{ bash_java_template }}"
        - filename: 50-maven.conf
          template: "{{ bash_maven_template }}"
  - powo.ubuntu-backports
  - powo.apache
  - powo.php
  - postgresql:
      postgresql_versions:
        - "9.6"
  - powo.postgresql-stop
  - postgresql-cluster:
      postgresql_cluster_clusters:
        - name: default
          path: /data/services/postgresql/9.6-default/
          postgresql_version: "9.6"
          port: 5432
          pg_hba: pg_hba_local.conf
  - powo.vagrant:
      pva_dest_folder: "{{ tools_folder }}/vagrant"
  - powo.gnome-shell
  - powo.chrome
  - powo.misc
  - powo.eclipse:
      pec_install_base_folder: "{{ apps_folder }}"
      pec_download_folder: "{{ tools_folder }}/eclipse"
      pec_bundles:
        - "{{ bundle_eclipse_java_471 }}"
        - "{{ bundle_eclipse_java_472 }}"
  - powo.java:
      pja_install_base_folder: "{{ apps_folder }}"
      pja_download_folder: "{{ tools_folder }}/java"
      pja_bundles:
        - "{{ bundle_jdk904 }}"
        - "{{ bundle_jdk18u162 }}"
  - powo.maven:
      pma_install_base_folder: "{{ apps_folder }}"
      pma_download_folder: "{{ tools_folder }}/maven"
      pma_bundles:
        - "{{ bundle_maven_3_3_9 }}"
        - "{{ bundle_maven_3_5_2 }}"
  - powo.tomcat:
      pto_install_base_folder: "{{ apps_folder }}"
      pto_download_folder: "{{ tools_folder }}/tomcat"
      pto_bundles:
        - "{{ bundle_tomcat_7_0_82 }}"
        - "{{ bundle_tomcat_8_0_47 }}"
        - "{{ bundle_tomcat_8_5_23 }}"
        - "{{ bundle_tomcat_9_0_1 }}"
  - powo.virtualbox
  - powo.symlinks:
      psy_directories:
        - ~/.bin
      psy_symlinks:
        - path: ~/.bin/java
          src: "{{ bin_java }}"
        - path: ~/.bin/eclipse
          src: "{{ bin_eclipse }}"
        - path: ~/.bin/mvn
          src: "{{ bin_maven }}"
meta:
  use_become: true
vars:
  become: true
  become_user: "{{ play_user }}"
  apps_folder: "{{ play_home }}/Documents/apps"
  tools_folder: "{{ play_home }}/Documents/tools"
  is_user_supplied: "{{ user is not none }}"
  play_user: "{{ user if user is not none else lookup('pipe', 'whoami') }}"
  play_uid: "{{ uid if uid is not none else lookup('pipe', 'id -u') }}"
  play_password: "{{ password | password_hash('sha512') if password else none }}"
  play_fullname: "{{ fullname }}"
  play_home: "{{ lookup('pipe', 'getent passwd ' + play_user).split(':')[5] }}"
  play_passphrase: "{{ passphrase }}"
  bundle_jdk18u151:
    url: http://download.oracle.com/otn-pub/java/jdk/8u151-b12/e758a0de34e24606bca991d704f6dcbf/jdk-8u151-linux-x64.tar.gz
    checksum: sha256:c78200ce409367b296ec39be4427f020e2c585470c4eed01021feada576f027f
    desktop_name: Java 1.8u151
  bundle_jdk18u152:
    url: http://download.oracle.com/otn-pub/java/jdk/8u152-b16/aa0333dd3019491ca4f6ddbe78cdb6d0/jdk-8u152-linux-x64.tar.gz
    checksum: sha256:218b3b340c3f6d05d940b817d0270dfe0cfd657a636bad074dcabe0c111961bf
    desktop_name: Java 1.8u152
  bundle_jdk18u162:
    url: http://download.oracle.com/otn-pub/java/jdk/8u162-b12/0da788060d494f5095bf8624735fa2f1/jdk-8u162-linux-x64.tar.gz
    checksum: sha256:68ec82d47fd9c2b8eb84225b6db398a72008285fafc98631b1ff8d2229680257
    desktop_name: Java 1.8u162
  bundle_jdk904:
    url: http://download.oracle.com/otn-pub/java/jdk/9.0.4+11/c2514751926b4512b076cc82f959763f/jdk-9.0.4_linux-x64_bin.tar.gz
    checksum: sha256:90c4ea877e816e3440862cfa36341bc87d05373d53389ec0f2d54d4e8c95daa2
    desktop_name: Java 9.0.4
    basename: jdk-9.0.4_linux-x64
  bundle_jdk17u80:
    # authentification needed :-/
    url: http://download.oracle.com/otn/java/jdk/7u80-b15/jdk-7u80-linux-x64.tar.gz
    checksum: sha256:bad9a731639655118740bee119139c1ed019737ec802a630dd7ad7aab4309623
    desktop_name: Java 1.7u80
  bundle_tomcat_7_0_82:
    url: http://apache.mindstudios.com/tomcat/tomcat-7/v7.0.82/bin/apache-tomcat-7.0.82.tar.gz
    checksum: sha1:4681bfbc86bb4da76a7aabbb3c545475eb9a8075
  bundle_tomcat_8_0_47:
    url: https://archive.apache.org/dist/tomcat/tomcat-8/v8.0.47/bin/apache-tomcat-8.0.47.tar.gz
    checksum: sha1:2b5a0d173040f9a576e372cae5d85b05599fd0eb
  bundle_tomcat_8_5_23:
    url: https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.23/bin/apache-tomcat-8.5.23.tar.gz
    checksum: sha1:1ba27c1bb86ab9c8404e98068800f90bd662523c
  bundle_tomcat_9_0_1:
    url: https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.2/bin/apache-tomcat-9.0.2.tar.gz
    checksum: sha1:b59e1d658a4edbca7a81d12fd6f20203a4da9743
  bundle_maven_3_5_2:
    url: http://mirrors.ircam.fr/pub/apache/maven/maven-3/3.5.2/binaries/apache-maven-3.5.2-bin.tar.gz
    checksum: md5:948110de4aab290033c23bf4894f7d9a
    basename: maven-3.5.2.tar.gz
  bundle_maven_3_3_9:
    url: http://mirrors.ircam.fr/pub/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz
    checksum: md5:516923b3955b6035ba6b0a5b031fbd8b
    basename: maven-3.3.9.tar.gz
  bundle_eclipse_java_471:
    url: http://dl.likide.org/eclipse/releases/eclipse-java-extra-oxygen-1-linux-gtk-x86_64.tar.gz
    checksum: sha256:7d0e7bca124474cd173e199c47103dab98fd4463bd097d03dd24abc17ee7a337
    desktop_name: Eclipse 4.7.1 (extra)
    vm: "{{ bin_java }}"
  bundle_eclipse_java_472:
    url: http://dl.likide.org/eclipse/releases/eclipse-java-extra-oxygen-2-linux-gtk-x86_64.tar.gz
    checksum: sha256:e538d55ab065535651115f961aa9345650e7516d735e99cced79cd15c37adbd4
    desktop_name: Eclipse 4.7.2 (extra)
    vm: "{{ bin_java }}"
  bin_java: "{{ apps_folder }}/{{ bundle_jdk18u152.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/bin/java"
  bin_eclipse: "{{ apps_folder }}/{{ bundle_eclipse_java_472.url | basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/eclipse"
  bin_maven: "{{ apps_folder }}/{{ bundle_maven_3_5_2.basename | regex_replace('(\\.[a-z]{1,3})*$', '') }}/bin/mvn"
  bash_maven_template: |
    export MAVEN_OPTS="-Xmx1024m"
  bash_java_template: |
    export JAVA_HOME={{ bin_java | dirname | dirname | expanduser | quote }}
